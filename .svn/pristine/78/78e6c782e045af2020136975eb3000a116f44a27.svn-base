/** dms1.0-v1.0.0 ISC License By  */
;"use strict";layui.extend({webuploader:"/uploader/webuploader"}).define(["layer","laytpl","table","element","webuploader"],function(e){var t,i=layui.$,a=layui.webuploader,l=layui.element,o=layui.layer,r=layui.table,n=[],d=104857600,s="doc,docx,pdf,xls,xlsx,ppt,pptx,gif,jpg,jpeg,bmp,png,rar,zip",u=10;layui.link("/layuiAdmin/src/layuiadmin/modules/uploader/webuploader.css");var p=function(e){var t=this;t.options=e,t.register(),t.init(),t.events()};p.prototype.init=function(){var e=this,i=e.options;e.strIsNull(i.size)||(d=i.size),e.strIsNull(e.options.fileType)||(s=e.options.fileType),u&&(u=e.options.fileNumLimit>10||e.options.fileNumLimit<0?u:e.options.fileNumLimit),o.open({type:1,area:["80%","90%"],resize:!1,content:' <div class="layui-form-item">\n        <div class="layui-card">'+e.options.contentArr+' <blockquote class="layui-elem-quote layui-text" style="margin-left: 10px;margin-right: 10px;">\n上传文件不能为空，格式只能为'+e.options.fileType+'\n</blockquote>\n<blockquote class="layui-elem-quote layui-text" style="margin-left: 10px;margin-right: 10px;">\n                    因技术上的限制，如果上传的文件是PDF格式的，则既可直接单击打开文件，也可以下载至本机阅读（据了解，专家们更愿意直接打开文件的操作方式），但如果是其他类型的文件，则只能下载至本机阅读，所以，建议被复核的学校使用PDF格式\n                </blockquote><div class="layui-card-body"><div  id="extend-upload-chooseFile" style="float: left;margin:10px,10px,10px,10px">选择文件</div><button id="extent-button-uploader" class="layui-btn" style="height: 37px;margin-left: 5px;padding-left: 10px;padding-bottom: 10px">开始上传</button></div></div></div><div style="margin-left: 10px;margin-right: 10px;"><table  class="layui-table" id="extend-uploader-form" lay-filter="extend-uploader-form">  <thead>    <tr>      <th lay-data="{type:\'numbers\', fixed:\'left\'}"></th>      <th lay-data="{field:\'fileName\'}">文件名称</th>      <th lay-data="{field:\'fileSize\', width:100}">文件大小</th>      <th lay-data="{field:\'progress\',templet:\'#button-form-optProcess\'}">进度</th>      <th lay-data="{field:\'oper\', width: 100,templet: \'#button-form-uploadTalbe\'}">操作</th>    </tr>  </thead></table></div><script type=\'text/html\' id=\'button-form-uploadTalbe\'>{{# if(d.state!=\'完成\'){}}<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>{{# }else{ }}<a class="layui-btn layui-btn-normal layui-btn-xs">完成</a>{{# } }}</script><script type="text/html" id="button-form-optProcess"><div style="margin-top: 5px;" class="layui-progress layui-progress-big" lay-filter="{{d.fileId}}"  lay-showPercent="true"><div class="layui-progress-bar layui-bg-blue" lay-percent="{{d.progressJd}}%"></div></div></script>',success:function(l,o){r.init("extend-uploader-form",{unresize:!0}),t=a.create({resize:!1,fileNumLimit:u,swf:"src/lib/extend/uploader/Uploader.swf",server:i.url,pick:"#extend-upload-chooseFile",fileSingleSizeLimit:d,accept:[{title:"file",extensions:s,mimeTypes:e.buildFileType(s)}],formData:i.data})},end:function(){n=[],i.success&&"function"==typeof i.success&&i.success()}})},p.prototype.formatFileSize=function(e){var t=0;if(e/1024>1024){var i=e/1024/1024;t=i.toFixed(2)+"MB"}else if(e/1024/1024>1024){var i=e/1024/1024;t=i.toFixed(2)+"GB"}else{var i=e/1024;t=i.toFixed(2)+"KB"}return t},p.prototype.buildFileType=function(e){for(var t=e.split(","),i="",a=0;a<t.length;a++)i=i+"."+t[a]+",";return i.substring(0,i.length-1)},p.prototype.strIsNull=function(e){return"undefined"==typeof e||null==e||""==e},p.prototype.events=function(){var e=this;t.on("fileQueued",function(t){if(n.length>=u)return o.msg("最多同一时间上传"+u+"个文件！");var i=e.formatFileSize(t.size),a={fileId:t.id,fileName:t.name,fileSize:i,validateMd5:"0%",progress:t.id,state:"就绪",progressJd:0};n.push(a),e.reloadData(n),l.render("progress")}),t.on("uploadProgress",function(e,t){l.progress(e.id,(100*t).toFixed(0)+"%");for(var i=0;i<n.length;i++)n[i].fileId===e.id&&(n[i].progressJd=(100*t).toFixed(0))}),t.on("error",function(e){"F_EXCEED_SIZE"==e?o.msg("上传的单个太大!。<br>操作无法进行,如有需求请联系管理员",{icon:5}):"Q_TYPE_DENIED"==e?o.msg("不允许上传此类文件!。<br>操作无法进行,如有需求请联系管理员",{icon:5}):(e="Q_EXCEED_NUM_LIMIT")&&o.msg("最多同一时间上传"+u+"个文件！")}),r.on("tool(extend-uploader-form)",function(i){var a=i.data;"del"===i.event&&(e.removeArray(n,a.fileId),t.removeFile(a.fileId,!0),i.del())}),i("#extent-button-uploader").click(function(){e.uploadToServer()}),t.on("uploadSuccess",function(t,i){0==i.status?e.setTableBtn(t.id,"完成"):1==i.status&&(o.alert(i.msg,{icon:2,shadeClose:!0,title:"提示"}),e.setTableBtn(t.id,"上传失败"))}),t.on("uploadFinished",function(){i("#extent-button-uploader").text("开始上传"),i("#extent-button-uploader").removeClass("layui-btn-disabled")})},p.prototype.reloadData=function(e){layui.table.reload("extend-uploader-form",{data:e})},p.prototype.register=function(){var e=this,o=e.options;e.strIsNull(o.md5)||a.Uploader.register({"before-send-file":"beforeSendFile"},{beforeSendFile:function(r){var n=new i.Deferred;return(new a.Uploader).md5File(r,0,10485760).progress(function(t){for(var a=e.getTableHead("validateMd5"),l=i("#extend-uploader-form").next().find('div[class="layui-table-body layui-table-main"]').find("table"),o=l.find('td[data-field="progress"]'),n=0;n<o.length;n++){var d=i(o[n]).attr("data-content");if(d==r.id){var s=i(o[n]).prev();s.empty(),s.append('<div class="'+a+'">'+(100*t).toFixed(0)+"%</div>")}}}).then(function(a){i.ajax({type:"POST",url:o.md5,data:{type:"md5Check",md5:a},cache:!1,timeout:3e3,dataType:"json"}).then(function(i,a,o){0==i.data?(n.reject(),t.skipFile(r),e.setTableBtn(r.id,"秒传"),l.progress(r.id,"100%")):n.resolve()},function(e,t,i){n.resolve()})}),i.when(n)}})},p.prototype.getTableHead=function(e){var t=i("#extend-uploader-form").next().find('div[class="layui-table-header"]'),a=t[0],l=i(a).find("table"),o=l.find('th[data-field="'+e+'"]').find("div").attr("class");return o},p.prototype.setTableBtn=function(e,t){for(var a=this.getTableHead("oper"),l=i("#extend-uploader-form").next().find('div[class="layui-table-body layui-table-main"]').find("table"),o=l.find('td[data-field="progress"]'),r=0;r<o.length;r++){var d=i(o[r]).attr("data-content");if(d==e){var s=i(o[r]).next();s.empty(),s.append('<div class="'+a+'"><a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="ok">'+t+"</a></div>")}}for(var u=0;u<n.length;u++)n[u].fileId===e&&(n[u].state="完成")},p.prototype.uploadToServer=function(){return n.length<=0?void o.msg("没有上传的文件",{icon:5}):(i("#extent-button-uploader").text("正在上传"),i("#extent-button-uploader").addClass("layui-btn-disabled"),void t.upload())},p.prototype.removeArray=function(e,t){for(var i=0;i<e.length;i++)e[i].fileId==t&&e.splice(i,1);return e};var f={render:function(e){var t=new p(e);return t}};e("layUploader",f)});