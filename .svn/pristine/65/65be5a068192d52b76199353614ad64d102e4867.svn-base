/** dms1.0-v1.0.0 ISC License By  */
 ;"use strict";layui.define(function(e){var t="treeTable",a=layui.$,i=function(){};i.prototype.config=function(){return{top_value:0,primary_key:"id",id_key:"id",parent_key:"pid",hide_class:"layui-hide",icon:{open:"layui-icon layui-icon-triangle-d",close:"layui-icon layui-icon-triangle-r",left:16},cols:[],checked:{},is_click_icon:!1,is_checkbox:!1,is_cache:!0}},i.prototype.template=function(e){var i=this,c=[],n="",d=a("table"+e.elem).length||!(e.is_click_icon=!0),l=e.is_checkbox?'<div class="layui-unselect layui-form-checkbox cbx" lay-skin="primary"><i class="layui-icon layui-icon-ok"></i></div>':"",o=l?l.replace("cbx","cbx layui-form-checked"):"",r=l&&'<th style="width:28px;">'+(a.inArray(e.top_value,e.checked.data)>-1?o:l)+"</th>";a.each(i.data(e,e.data),function(t,s){var h="",p=!1,y=s[e.parent_key]==e.top_value||s[e.parent_key]==i.cache(e,s[e.parent_key])?"":e.hide_class;s.level=c[s[e.id_key]]=s[e.parent_key]!=e.top_value?c[s[e.parent_key]]+1:0,s.is_end=!e.childs[s[e.id_key]],a.each(e.cols,function(n,y){var u="";y.width&&(u+="width:"+y.width+";"),y.align&&(u+="text-align:"+y.align+";"),u&&(u='style="'+u+'"'),e.is_checkbox&&e.checked&&a.inArray(s[e.checked.key],e.checked.data)>-1&&(p=!0),t||(r+="<th "+u+">"+y.title+"</th>");var k=y.key!=e.icon_key||s.is_end?"<span></span>":'<i class="'+(i.cache(e,s[e.id_key])?e.icon.open:e.icon.close)+'"></i>',f=y.key==e.icon_key?c[s[e.id_key]]*e.icon.left+"px":"";k=k.replace(">",' style="margin-left:'+f+';">'),h+="<td "+u+(f?"data-down":"")+">"+k+(d?"":p?o:l)+(y.template?y.template(s):s[y.key])+"</td>"});var u=d?a(p?o:l).wrap('<td style="width:28px;">').parent().prop("outerHTML"):"";n+='<tr class="'+y+'" data-idkey="'+s[e.primary_key]+'" data-id="'+s[e.id_key]+'" data-pid="'+s[e.parent_key]+'">'+u+h+"</tr>"});var s=d?'<thead><tr data-id="'+e.top_value+'">'+r+"</tr></thead><tbody>"+n+"</tbody>":n.replace(/<tr/g,"<ul").replace(/tr>/g,"ul>").replace(/<td/g,"<li").replace(/td>/g,"li>"),h=e.is_click_icon?"[data-down] i:not(.layui-icon-ok)":"[data-down]";a(e.elem).html(s).off("click",h).on("click",h,function(){var c=a(this).parents("[data-id]"),n=c.find("[data-down]"),d=c.data("id"),l=c.data("pid"),o=n.find("i:not(.layui-icon-ok)").attr("class")==e.icon.close;o?(n.find("i:not(.layui-icon-ok)").attr("class",e.icon.open),n.parents(e.elem).find("[data-pid="+d+"]").removeClass(e.hide_class),i.cache(e,d,!0)):(n.find("i:not(.layui-icon-ok)").attr("class",e.icon.close),i.childs_hide(e,d)),layui.event.call(this,t,"tree(flex)",{elem:this,item:e.childs[l][d],table:e.elem,is_open:o})}).off("click",".cbx").on("click",".cbx",function(){var c=a(this).toggleClass("layui-form-checked").hasClass("layui-form-checked"),n=a(this).parents("[data-id]"),d=n.data("id"),l=n.data("pid");i.childs_checkbox(e,d,c),i.parents_checkbox(e,l),layui.event.call(this,t,"tree(box)",{elem:this,item:void 0===l?{}:e.childs[l][d],table:e.elem,is_checked:c})}).off("click","[lay-filter]").on("click","[lay-filter]",function(){var i=a(this).parents("[data-id]"),c=i.data("id"),n=i.data("pid"),d=a(this).attr("lay-filter");return layui.event.call(this,t,"tree("+d+")",{elem:this,item:e.childs[n][c]})}),e.end&&e.end(e)},i.prototype.parents_checkbox=function(e,t){var i=a(e.elem).find('[data-pid="'+t+'"]'),c=a(e.elem).find('[data-id="'+t+'"]'),n=a(e.elem).find('[data-pid="'+t+'"] .cbx.layui-form-checked').length;if(i.length==n||0==n){var t=c.data("pid");n?c.find(".cbx").addClass("layui-form-checked"):c.find(".cbx").removeClass("layui-form-checked"),void 0===t||this.parents_checkbox(e,t)}},i.prototype.childs_checkbox=function(e,t,i){var c=this;a(e.elem).find("[data-pid="+t+"]").each(function(){var t=a(this).find(".cbx");i?t.addClass("layui-form-checked"):t.removeClass("layui-form-checked"),c.childs_checkbox(e,a(this).data("id"),i)})},i.prototype.childs_hide=function(e,t){var i=this;i.cache(e,t,!1),a(e.elem).find("[data-pid="+t+"]:not(."+e.hide_class+")").each(function(){var c=a(this).find("[data-down]"),n=c.find("i:not(.layui-icon-ok)");n.length&&n.attr("class",e.icon.close),c.parents(e.elem).find("[data-pid="+t+"]").addClass(e.hide_class),i.childs_hide(e,a(this).data("id"))})},i.prototype.data=function(e){var t=[],i=[];return a.each(e.data,function(a,c){t[c[e.id_key]]=c,i[c[e.parent_key]]||(i[c[e.parent_key]]=[]),i[c[e.parent_key]][c[e.id_key]]=c}),e.childs=i,this.tree_data(e,t,e.top_value,[])},i.prototype.tree_data=function(e,t,i,c){var n=this;return t[i]&&(c.push(t[i]),delete t[i]),a.each(e.data,function(a,d){d[e.parent_key]==i&&c.concat(n.tree_data(e,t,d[e.id_key],c))}),c},i.prototype.render=function(e){var t=this;return e=a.extend(t.config(),e),e.url?a.get(e.url,function(a){e.data=a,t.template(e)}):t.template(e),e},i.prototype.checked=function(e){var t=[];return a(e.elem).find(".cbx.layui-form-checked").each(function(){var e=a(this).parents("[data-idkey]").data("idkey");t.push(e)}),t},i.prototype.openAll=function(e){var t=this;a.each(e.data,function(a,i){i[e.id_key]&&t.cache(e,i[e.id_key],!0)}),t.render(e)},i.prototype.closeAll=function(e){localStorage.setItem(e.elem.substr(1),""),this.render(e)},i.prototype.on=function(e,a){return layui.onevent.call(this,t,e,a)},i.prototype.cache=function(e,t,i){if(!e.is_cache)return!1;var c=e.elem.substr(1),t=t.toString(),n=localStorage.getItem(c)?localStorage.getItem(c).split(","):[],d=a.inArray(t,n);return void 0===i?d!=-1&&t:(i&&d==-1&&n.push(t),!i&&d>-1&&n.splice(d,1),void localStorage.setItem(c,n.join(",")))};var i=new i;e(t,i)});